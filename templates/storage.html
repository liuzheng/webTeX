{% extends "base.html" %}
{% block cssjs %}
    {#    <link rel="stylesheet" type="text/css" href="/css/ng-table.css"/>#}

    <script src="/js/lib/angular.min.js"></script>
    {#    <script src="/js/lib/ng-table.js"></script>#}
{% endblock %}
{% block content %}
    <style>
        th {
            text-align: center
        }
    </style>
    <div class="col-md-12" ng-app="app" ng-controller="Ctrl">
        <table class="table table-responsive table-bordered">
            <thead style="overflow:auto;">
            <tr>
                <th rowspan="2">用户ID</th>
                <th colspan="7">主信息</th>
                <th colspan="4">用户信息</th>
                <th colspan="4">其他信息</th>
            </tr>
            <tr>
                <th>微博信息内容</th>
                <th>微博ID</th>
                <th>转发数</th>
                <th>微博创建时间</th>
                <th>是否自已发的的微博</th>
                <th>微博类型</th>
                <th>心情类型</th>
                <th>发表人帐户名</th>
                <th>发表人昵称</th>
                <th>微博来源</th>
                <th>用户所在地</th>
                <th>国家码</th>
                <th>省份码</th>
                <th>城市码</th>
                <th>地理信息</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="u in data">
                <td>{[{ u.uid }]}</td>
                <td>{[{ u['mainInfo:text'] }]}</td>
                <td>{[{ u['mainInfo:wid'] }]}</td>
                <td>{[{ u['mainInfo:count'] }]}</td>
                <td>{[{ u['mainInfo:TimeStemp'] }]}</td>
                <td>{[{ u['mainInfo:self'] }]}</td>
                <td>{[{ u['mainInfo:type'] }]}</td>
                <td>{[{ u['mainInfo:emotiontype'] }]}</td>
                <td>{[{ u['userInfo:name'] }]}</td>
                <td>{[{ u['userInfo:nick'] }]}</td>
                <td>{[{ u['userInfo:source'] }]}</td>
                <td>{[{ u['userInfo:location'] }]}</td>
                <td>{[{ u['otherInfo:CountryCode'] }]}</td>
                <td>{[{ u['otherInfo:ProvinceCode'] }]}</td>
                <td>{[{ u['otherInfo:CityCode'] }]}</td>
                <td>{[{ u['otherInfo:geo'] }]}</td>
            </tr>

            </tbody>
        </table>
    </div>
    <div class="col-md-2"></div>
    <script>
        var app = angular.module('app', []);
        app.config(function ($interpolateProvider) {
            $interpolateProvider.startSymbol('{[{');
            $interpolateProvider.endSymbol('}]}');
        });
        app.controller('Ctrl', function ($scope, $http) {
            $scope.get = function () {
                $http({
                    url: "/api/weibo",
                    method: 'GET'
                }).success(function (data) {
                    $scope.data = {};
                    for (k in data['data']) {
                        for (w in data['data'][k]) {
                            if (w === 'mainInfo:count') {
                                continue
                            }
                            var wid = w.match(/\d*$/g)[0];
                            var key = w.match(/[^\d]*/g)[0];
                            if (!$scope.data[wid]){
                                $scope.data[wid]={}
                            }
                            $scope.data[wid]['uid']=k;
                            $scope.data[wid][key] = data['data'][k][w];
                        }
                    }
{#                    console.log($scope.data)#}
{#                    $scope.data = data['data']#}
                });
            };
            $scope.get()

        });
    </script>
{% endblock %}